library(plyr)
library(e1071)
library(ggplot)
basedir <- "/home2/data/Projects/CCD"
network_names <- c("medial visual", "occipital pole visual", "lateral visual", "default network", "cerebellum", "sensorimotor", "auditory", "executive control", "right frontoparietal", "left frontoparietal")
nn <- gsub(" ", ".", network_names)
important_networks <- c(4,8,9,10)
# Read in the phenotype data
fname <- file.path(basedir, "behavior/ccd_totals_touse.csv")
phenos <- read.csv(fname, row.names=1)
# Read in the RSNs
fnames <- sort(Sys.glob(file.path(basedir, "analysis/subjects/*/rest/run_01/rsn10.1D")))
rest_tcs <- llply(fnames, read.table, .progress="text")
fnames <- sort(Sys.glob(file.path(basedir, "analysis/subjects/*/msit/run_01/rsn10.1D")))
msit_run1_tcs <- llply(fnames, read.table, .progress="text")
fnames <- sort(Sys.glob(file.path(basedir, "analysis/subjects/*/msit/run_02/rsn10.1D")))
msit_run2_tcs <- llply(fnames, read.table, .progress="text")
# Get kurtosis
rest_kurtosis <- laply(rest_tcs, apply, 2, kurtosis, .progress="text")
msit_run1_kurtosis <- laply(msit_run1_tcs, apply, 2, kurtosis, .progress="text")
msit_run2_kurtosis <- laply(msit_run2_tcs, apply, 2, kurtosis, .progress="text")
colnames(rest_kurtosis) <- network_names
colnames(msit_run1_kurtosis) <- network_names
colnames(msit_run2_kurtosis) <- network_names
# Merge with phenotype
df.rest <- data.frame(
    phenos, 
    rest_kurtosis
)
n <- nrow(msit_run1_kurtosis)
df.msit <- data.frame(
    study_id = factor(rep(phenos$study_id[1:n], 2)), 
    run = factor(rep(c(1,2), each=n)), 
    rbind(phenos[1:n,-1], phenos[1:n,-1]), 
    rbind(msit_run1_kurtosis, msit_run2_kurtosis)
)
df.msit_and_rest <- data.frame(
    study_id = factor(rep(phenos$study_id[1:n], 2)), 
    scan = factor(rep(c("msit", "rest"), each=n)), 
    rbind(phenos[1:n,-1], phenos[1:n,-1]), 
    rbind((msit_run1_kurtosis+msit_run2_kurtosis)/2, rest_kurtosis[1:n,])
)
df.msit_vs_rest <- data.frame(
    study_id = phenos$study_id[1:n], 
    phenos[1:n,-1], 
    (msit_run1_kurtosis+msit_run2_kurtosis)/2 - rest_kurtosis[1:n,]
)
res.rest <- llply(nn, function(network) {
    summary(aov(df.rest[[network]] ~ Age + Sex + RRS_Brooding + RRS_Reflection + RRS_Depression + PANAS_Positive + PANAS_Negative, df.rest))
}, .progress="text")
names(res.rest) <- nn
res.rest[important_networks]
res.msit <- llply(nn, function(network) {
    summary(aov(df.msit[[network]] ~ Age + Sex + RRS_Brooding + RRS_Reflection + RRS_Depression + PANAS_Positive + PANAS_Negative + Error(study_id), df.msit))
})
res.msit[important_networks]
res.msit_vs_rest <- llply(nn, function(network) {
    summary(aov(df.msit_vs_rest[[network]] ~ Age + Sex + RRS_Brooding + RRS_Reflection + RRS_Depression + PANAS_Positive + PANAS_Negative, df.msit_vs_rest))
}, .progress="text")
res.msit_vs_rest[important_networks]
ls()
rm(ls())
rm(list=ls())
gc()
